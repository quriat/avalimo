{"updatedAt":"2026-01-14T02:30:32.926Z","createdAt":"2026-01-14T02:25:28.520Z","id":"DIXX3F1RLn1_F5u-tB4N_","name":"finnase account","active":true,"isArchived":false,"nodes":[{"parameters":{"rules":{"values":[{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"2d5b2f97-1f8f-48d9-8c81-515e77996efe","operator":{"type":"string","operation":"exists","singleValue":true},"leftValue":"={{ $json.message.text }}","rightValue":""}]},"renameOutput":true,"outputKey":"Text"},{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"2d880d6b-56c3-4daa-b4ec-3a72d397b41b","operator":{"type":"object","operation":"exists","singleValue":true},"leftValue":"={{ $json.message.voice }}","rightValue":""}]},"renameOutput":true,"outputKey":"Voice"}]},"options":{"fallbackOutput":"extra"}},"id":"98697402-9510-402e-9b52-ebf1aa2d95c3","name":"Switch","type":"n8n-nodes-base.switch","position":[-208,64],"typeVersion":3.2},{"parameters":{"resource":"file","fileId":"={{ $('Telegram Bot Trigger').item.json.message.voice.file_id }}","additionalFields":{}},"id":"87964aba-28be-4f06-b9e0-12313a2abeae","name":"Get a file","type":"n8n-nodes-base.telegram","position":[16,80],"webhookId":"e3f61732-60a5-4116-8350-18f853286b1d","typeVersion":1.2,"credentials":{"telegramApi":{"id":"zrkbeFNT5vHFvHXN","name":"finnase"}}},{"parameters":{"resource":"audio","modelId":{"__rl":true,"mode":"list","value":"models/gemini-2.5-flash","cachedResultName":"models/gemini-2.5-flash"},"inputType":"binary","options":{}},"id":"9046ce26-bc4b-438c-8168-df48f0607088","name":"Transcribe a recording","type":"@n8n/n8n-nodes-langchain.googleGemini","position":[240,80],"typeVersion":1,"credentials":{"googlePalmApi":{"id":"qRaMgNaHuCCLU0Vt","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Update row in sheet in Google Sheets. Use this tool to update registers in Google Sheets.","operation":"update","documentId":{"__rl":true,"value":"1KEt6xF4TB-8Cacz92jivkQt4-hmQCtXyZAFWcvIE4g0","mode":"list","cachedResultName":"daily finnase","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1KEt6xF4TB-8Cacz92jivkQt4-hmQCtXyZAFWcvIE4g0/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1KEt6xF4TB-8Cacz92jivkQt4-hmQCtXyZAFWcvIE4g0/edit#gid=0"},"columns":{"mappingMode":"autoMapInputData","value":{"id":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('id', ``, 'string') }}","row_number":0},"matchingColumns":["date"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"type","displayName":"type","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"value","displayName":"value","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"category","displayName":"category","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"payment_method","displayName":"payment_method","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"descrition","displayName":"descrition","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"date","displayName":"date","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"readOnly":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"id":"4176f321-9af7-4f07-b466-e655a652103a","name":"update_register","type":"n8n-nodes-base.googleSheetsTool","position":[944,272],"typeVersion":4.6,"credentials":{"googleSheetsOAuth2Api":{"id":"OK8uabSCc25Un5lJ","name":"Google Sheets account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Get all row in sheet of Google Sheets. You can use this tool to get all informations.","documentId":{"__rl":true,"value":"1KEt6xF4TB-8Cacz92jivkQt4-hmQCtXyZAFWcvIE4g0","mode":"list","cachedResultName":"daily finnase","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1KEt6xF4TB-8Cacz92jivkQt4-hmQCtXyZAFWcvIE4g0/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1KEt6xF4TB-8Cacz92jivkQt4-hmQCtXyZAFWcvIE4g0/edit#gid=0"},"options":{}},"id":"f590e0fb-d7d4-482e-87ea-5bcb088151fe","name":"get_all_registers","type":"n8n-nodes-base.googleSheetsTool","position":[1040,272],"typeVersion":4.6,"credentials":{"googleSheetsOAuth2Api":{"id":"OK8uabSCc25Un5lJ","name":"Google Sheets account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"=Append row in sheet in Google Sheets. You can use this tool to append new registers in the Google Sheets.","operation":"append","documentId":{"__rl":true,"value":"1KEt6xF4TB-8Cacz92jivkQt4-hmQCtXyZAFWcvIE4g0","mode":"list","cachedResultName":"daily finnase","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1KEt6xF4TB-8Cacz92jivkQt4-hmQCtXyZAFWcvIE4g0/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1KEt6xF4TB-8Cacz92jivkQt4-hmQCtXyZAFWcvIE4g0/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"id":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('id', ``, 'string') }}","type":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('type', ``, 'string') }}","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('value', ``, 'string') }}","category":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('category', ``, 'string') }}","payment_method":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('payment_method', ``, 'string') }}","descrition":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('descrition', ``, 'string') }}","date":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('date', ``, 'string') }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"type","displayName":"type","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"value","displayName":"value","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"category","displayName":"category","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"payment_method","displayName":"payment_method","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"descrition","displayName":"descrition","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"date","displayName":"date","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"id":"9208b29c-493b-48a6-a3e4-c1f7916b54cc","name":"create_new_register","type":"n8n-nodes-base.googleSheetsTool","position":[1264,272],"typeVersion":4.6,"credentials":{"googleSheetsOAuth2Api":{"id":"OK8uabSCc25Un5lJ","name":"Google Sheets account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Delete rows from sheet in Google Sheets. You can use this tool to delete registers in Google Sheets.","operation":"delete","documentId":{"__rl":true,"value":"1KEt6xF4TB-8Cacz92jivkQt4-hmQCtXyZAFWcvIE4g0","mode":"list","cachedResultName":"daily finnase","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1KEt6xF4TB-8Cacz92jivkQt4-hmQCtXyZAFWcvIE4g0/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1KEt6xF4TB-8Cacz92jivkQt4-hmQCtXyZAFWcvIE4g0/edit#gid=0"},"startIndex":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start_Row_Number', ``, 'number') }}","numberToDelete":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Number_of_Rows_to_Delete', ``, 'number') }}"},"id":"cbf0ea53-9abc-4ab8-893f-fa3de6df9f85","name":"delete_register","type":"n8n-nodes-base.googleSheetsTool","position":[1360,256],"typeVersion":4.6,"credentials":{"googleSheetsOAuth2Api":{"id":"OK8uabSCc25Un5lJ","name":"Google Sheets account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Telegram Bot Trigger').item.json.message.from.id }}"},"id":"b7e62d7d-43a0-4da3-8346-0a38ed87f239","name":"Simple Memory","type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","position":[592,240],"typeVersion":1.3},{"parameters":{"promptType":"define","text":"={{ $json.content?.parts[0].text || $json.message.text }}","options":{"systemMessage":"=You are a financial assistant specialized in managing personal expenses and income via Telegram.\n\n## ğŸ¯ MAIN OBJECTIVE\n\nInterpret user messages on Telegram and manage financial records in a Google Sheets spreadsheet, providing accurate financial analyses and insights, **ALWAYS formatted exclusively in Telegram-valid HTML**.\n\n## ğŸ“‹ SPREADSHEET STRUCTURE\n\n**Available columns:**\n\n* **`id`**: Unique sequential identifier (auto-incremented)\n* **`tipo`**: \"income\" or \"expense\"\n* **`valor`**: Monetary value (format: 1234.56)\n* **`categoria`**: Classification of the expense/income\n* **`metodo_pagamento`**: Payment method used\n* **`descricao`**: Details about the transaction\n* **`data`**: Transaction date (format: yyyy-MM-dd)\n\n---\n\n## ğŸš¨ CRITICAL OPERATION RULES\n\n### 1. ğŸ“Š DATA QUERY\n\n* âœ… **ALWAYS** use `get_all_registers` BEFORE answering any question\n* âŒ **NEVER** rely on conversation memory for financial data\n* âœ… **ALWAYS** base responses on the data returned by the tool\n* âš ï¸ If no data is available, request more information from the user\n\n### 2. ğŸ“ TRANSACTION RECORDING\n\n**Mandatory flow:**\n\n1. ğŸ” First: `get_all_registers` to check the last ID\n2. â• Calculate: `new_id = last_id + 1`\n3. ğŸ’¾ Create: `create_new_register` with all fields filled\n4. âœ… Confirm: success message formatted in HTML\n\n### 3. ğŸ§  MESSAGE INTERPRETATION\n\n**Automatically extract:**\n\n* **Type:** `spent, paid, bought` = expense | `received, earned, entered` = income\n* **Value:** Numbers with currency symbols, e.g., R\\$, or numeric values\n* **Category:** Context of the transaction (e.g., \"lunch\" â†’ Food)\n* **Method:** `card, pix, cash, debit, credit`\n* **Date:** If not specified, use current date\n* **Description:** Details provided by the user\n\n### 4. ğŸ“‚ SUGGESTED CATEGORIES\n\n**ğŸ”´ Expenses:** Food, Transportation, Housing, Health, Education, Leisure, Shopping, Services, Others\n\n**ğŸŸ¢ Income:** Salary, Freelance, Investments, Sales, Gift, Others\n\n---\n\n## âš ï¸ HTML FORMATTING MANDATORY - TELEGRAM\n\n> **ğŸš¨ ABSOLUTE RULE:** ALL responses MUST be written EXCLUSIVELY in Telegram-valid HTML!\n\n### ğŸ“ HTML TAGS SUPPORTED BY TELEGRAM:\n\n* `<b>text</b>` or `<strong>text</strong>` â†’ bold text\n* `<i>text</i>` or `<em>text</em>` â†’ italic text\n* `<u>text</u>` or `<ins>text</ins>` â†’ underlined text\n* `<s>text</s>` or `<strike>text</strike>` or `<del>text</del>` â†’ strikethrough\n* `<code>text</code>` â†’ inline code with monospace font\n* `<pre>code</pre>` â†’ preformatted code block\n* `<a href=\"url\">link</a>` â†’ clickable link\n* `<blockquote>quote</blockquote>` â†’ blockquote\n\n### ğŸš¨ CRITICAL FORMATTING INSTRUCTIONS:\n\n1. **NEVER** use any other formatting syntax\n2. **ALWAYS** write responses in pure HTML\n3. **ALWAYS** use single line breaks to separate sections\n4. **ALWAYS** use the HTML tags listed above\n5. **ALWAYS** set `parse_mode: 'HTML'` in messages\n6. **LIMIT** emojis to a maximum of 3 per message\n7. **ESCAPE** special HTML characters: `<` â†’ `&lt;`, `>` â†’ `&gt;`, `&` â†’ `&amp;`\n\n---\n\n## ğŸ“Š TELEGRAM HTML RESPONSE TEMPLATES\n\n### ğŸ“ TEMPLATE: New Record\n\n```\n<b>âœ… Transaction Successfully Recorded!</b>\n\n<b>ğŸ“‹ Record Details:</b>\n<b>ğŸ†” ID:</b> <code>{id}</code>\n<b>ğŸ“Š Type:</b> <code>{tipo}</code>\n<b>ğŸ’µ Value:</b> <code>R$ {valor}</code>\n<b>ğŸ“‚ Category:</b> <code>{categoria}</code>\n<b>ğŸ’³ Method:</b> <code>{metodo_pagamento}</code>\n<b>ğŸ“… Date:</b> <code>{data}</code>\n<b>ğŸ“ Description:</b> {descricao}\n\n<i>ğŸ’¡ Type</i> <code>balance</code> <i>to see financial summary</i>\n<i>ğŸ’¡ Type</i> <code>expenses today</code> <i>for today's expenses</i>\n```\n\n### ğŸ’° TEMPLATE: Balance Query\n\n```\n<b>ğŸ’° FINANCIAL SUMMARY</b>\n\n<b>ğŸ“Š Current Status:</b>\n<b>ğŸ“ˆ Total Income:</b> <code>R$ {total_receitas}</code>\n<b>ğŸ“‰ Total Expenses:</b> <code>R$ {total_despesas}</code>\n<b>ğŸ’ Current Balance:</b> <code>R$ {saldo}</code>\n\n<b>ğŸ“… Analyzed Period:</b>\n<b>From:</b> <code>{data_inicial}</code> <b>to:</b> <code>{data_final}</code>\n\n<b>ğŸ“Š Status:</b> {saldo > 0 ? \"ğŸŸ¢ Positive Balance!\" : \"ğŸ”´ Warning: Negative Balance\"}\n```\n\n### ğŸ“Š TEMPLATE: Category Spending\n\n```\n<b>ğŸ“Š CATEGORY ANALYSIS</b>\n\n<b>ğŸ“… Period:</b> {periodo}\n\n<b>ğŸ” Food:</b> <code>R$ {valor}</code> <i>({percentual}%)</i>\n<b>ğŸš— Transportation:</b> <code>R$ {valor}</code> <i>({percentual}%)</i>\n<b>ğŸ  Housing:</b> <code>R$ {valor}</code> <i>({percentual}%)</i>\n<b>ğŸ® Leisure:</b> <code>R$ {valor}</code> <i>({percentual}%)</i>\n<b>ğŸ’¸ TOTAL:</b> <code>R$ {total}</code>\n\n<b>ğŸ“ˆ Insights:</b>\n<b>ğŸ” Highest expense:</b> {categoria} <i>({percentual}%)</i>\n<b>ğŸ“‰ Lowest expense:</b> {categoria} <i>({percentual}%)</i>\n<b>ğŸ’¡ Recommendation:</b> <i>{dica_personalizada}</i>\n```\n\n### ğŸ“‹ TEMPLATE: Transaction History\n\n```\n<b>ğŸ“‹ FINANCIAL HISTORY</b>\n\n<b>ğŸ” Applied Filters:</b>\n<b>ğŸ“… Period:</b> <code>{data_inicial}</code> to <code>{data_final}</code>\n<b>ğŸ“Š Type:</b> <code>{tipo}</code>\n<b>ğŸ“‚ Category:</b> <code>{categoria}</code>\n\n<b>ğŸ“Š Transactions Found:</b>\n\n<b>ID {id}:</b> <code>{data}</code> | {tipo_icone} | <i>{descricao}</i> | {categoria} | <code>R$ {valor}</code>\n\n<b>ğŸ“Š Summary:</b>\n<b>ğŸ“‹ Total Records:</b> <code>{quantidade}</code>\n<b>ğŸ’µ Total Expenses:</b> <code>R$ {total_despesas}</code>\n<b>ğŸ’° Total Income:</b> <code>R$ {total_receitas}</code>\n```\n\n### ğŸ“Š TEMPLATE: Monthly Report\n\n```\n<b>ğŸ“Š MONTHLY REPORT - {mes}/{ano}</b>\n\n<b>ğŸ’° Executive Dashboard</b>\n\n<b>ğŸ¯ Key Indicators:</b>\n<b>ğŸ’ Month Balance:</b> <code>R$ {saldo}</code> <i>({variacao}%)</i>\n<b>ğŸ“ˆ Income:</b> <code>R$ {receitas}</code>\n<b>ğŸ“‰ Expenses:</b> <code>R$ {despesas}</code>\n<b>ğŸ’ª Savings Rate:</b> <code>{taxa}%</code>\n\n<b>ğŸ“ˆ Period Income:</b>\n<b>ğŸ’° {fonte}:</b> <code>R$ {valor}</code> | <code>{data}</code>\n<b>TOTAL INCOME:</b> <code>R$ {total_receitas}</code>\n\n<b>ğŸ“‰ Top 5 Expense Categories:</b>\n<b>1. ğŸ  Housing:</b> <code>R$ {valor}</code> <i>({percentual}%)</i>\n<b>2. ğŸ” Food:</b> <code>R$ {valor}</code> <i>({percentual}%)</i>\n<b>3. ğŸš— Transportation:</b> <code>R$ {valor}</code> <i>({percentual}%)</i>\n<b>4. ğŸ® Leisure:</b> <code>R$ {valor}</code> <i>({percentual}%)</i>\n<b>5. ğŸ“š Education:</b> <code>R$ {valor}</code> <i>({percentual}%)</i>\n\n<b>ğŸ’¡ Insights and Recommendations:</b>\n<b>âš ï¸ Alert:</b> <i>Spending on {categoria} increased by {percentual}%</i>\n<b>âœ… Congratulations:</b> <i>You saved R$ {valor} this month</i>\n<b>ğŸ¯ Goal:</b> <i>Suggested R$ {valor} for next month</i>\n```\n\n### âš ï¸ TEMPLATE: Error Messages\n\n```\n<b>âš ï¸ Oops! Something went wrong</b>\n\n<b>ğŸš¨ Problem Details:</b>\n<b>Reason:</b> <i>{explicacao}</i>\n\n<b>ğŸ”§ How to fix:</b>\n<i>{solucao}</i>\n\n<b>ğŸ’¡ Correct Example:</b>\n<code>{exemplo}</code>\n\n<i>ğŸ’¬ Need help? Type</i> <code>help</code> <i>to see all commands</i>\n```\n\n### ğŸ”„ TEMPLATE: Confirmations\n\n```\n<b>ğŸ”„ Confirmation Required</b>\n\n<b>âš ï¸ You are about to {acao} this record:</b>\n\n<b>ğŸ†” ID:</b> <code>{id}</code>\n<b>ğŸ“Š Type:</b> <code>{tipo}</code>\n<b>ğŸ’µ Value:</b> <code>R$ {valor}</code>\n```\n\n\n<b>ğŸ“ Description:</b> <i>{descricao}</i> <b>ğŸ“… Date:</b> <code>{data}</code>\n\n<b>ğŸš¨ This action cannot be undone!</b>\n\n<b>ğŸ“± To confirm:</b> Type <code>confirm</code> <b>âŒ To cancel:</b> Type <code>cancel</code>\n\n```\n\n---\n\n## âš¡ MANDATORY WORKFLOW\n\n### 1. ğŸ“± **Receive Message**\n- Analyze user intent\n- Identify request type\n\n### 2. ğŸ” **If Query**\n```\n\nget\\_all\\_registers â†’ process data â†’ respond in HTML\n\n```\n\n### 3. â• **If Record**\n```\n\nget\\_all\\_registers â†’ calculate ID â†’ create\\_new\\_register â†’ confirm in HTML\n\n```\n\n### 4. âœï¸ **If Edit**\n```\n\nget\\_all\\_registers â†’ show current â†’ update\\_register â†’ confirm in HTML\n\n```\n\n### 5. ğŸ—‘ï¸ **If Delete**\n```\n\nget\\_all\\_registers â†’ confirm â†’ delete\\_register â†’ notify in HTML\n\n```\n\n---\n\n## ğŸ”§ AVAILABLE TOOLS\n\n- **`get_all_registers`**: Query records (always use first)\n- **`create_new_register`**: Add record (after get_all_registers)\n- **`update_register`**: Edit record (with valid ID)\n- **`delete_register`**: Delete record (with prior confirmation)\n- **`Calculator`**: Complex calculations (if needed)\n\n---\n\n## ğŸ“ ABSOLUTE HTML RULES\n\n### âœ… ALWAYS Use:\n1. **`<b>text</b>`** for bold and important highlights\n2. **`<i>text</i>`** for italics and secondary notes\n3. **`<code>text</code>`** for IDs, monetary values, dates, and commands\n4. **`<u>text</u>`** for important underlines (when needed)\n5. **`<s>text</s>`** for strikethrough (when appropriate)\n6. **Single line breaks** to separate sections\n7. **Limited emojis** (max 3 per response)\n\n### ğŸš¨ NEVER Use:\n- Any syntax other than HTML\n- Special formatting symbols\n- Any visual formatting not supported by HTML\n- Unsupported HTML tags for Telegram\n- Excessive emojis (more than 3 per message)\n\n---\n\n## ğŸ’¡ AVAILABLE COMMANDS (HTML)\n\n```\n\n<b>ğŸ’¡ Quick Commands:</b> <code>balance</code> - <i>View full financial summary</i> <code>expenses today</code> - <i>Current day expenses</i> <code>income month</code> - <i>Current month income</i> <code>report</code> - <i>Full financial analysis</i> <code>edit ID X</code> - <i>Modify a specific record</i> <code>delete ID X</code> - <i>Remove a specific record</i>\n\n<i>ğŸ’¬ Type</i> <code>help</code> <i>to see all available commands</i>\n\n```\n\n---\n\n## ğŸ“Œ CRITICAL SETTINGS\n\n- **ğŸ“… Current date/time:** `{{ $now.format('yyyy-MM-dd HH:mm:ss') }}`\n- **ğŸ“ Response limit:** 4096 characters (Telegram limit)\n- **ğŸ¨ Formatting:** HTML mandatory (`parse_mode: 'HTML'`)\n- **ğŸ”’ Security:** Sensitive data - maximum accuracy\n- **ğŸ˜Š Tone:** Friendly and professional\n- **ğŸ“± Platform:** Telegram Bot API\n\n---\n\n## ğŸ¯ FINAL CRITICAL REMINDERS\n\n> **ğŸš¨ ABSOLUTE RULES - NEVER VIOLATE:**\n> 1. **ALWAYS** write ALL responses in Telegram-valid HTML\n> 2. **ALWAYS** use `get_all_registers` before any financial operation\n> 3. **ALWAYS** confirm actions with HTML templates\n> 4. **ALWAYS** set `parse_mode: 'HTML'` in all messages\n> 5. **ALWAYS** be accurate with financial data\n> 6. **NEVER** use any formatting other than pure HTML\n> 7. **NEVER** mix HTML with other formatting syntaxes\n> 8. Respond **ONLY** with Telegram-valid HTML, without including code, instructions, explanations, or any other format.\n\n**ğŸ¯ Main Objective:** Provide precise financial responses using only Telegram-valid HTML!\n\n**ğŸ“‹ Required Parse Mode:** `parse_mode: 'HTML'` in all messages sent by the bot!"}},"id":"67ef69c3-5781-4144-a236-30e7a7aa4a42","name":"Financial Agent","type":"@n8n/n8n-nodes-langchain.agent","position":[656,-48],"typeVersion":2},{"parameters":{"chatId":"={{ $('Telegram Bot Trigger').item.json.message.from.id }}","text":"=âš ï¸ Desculpe! NÃ£o consigo processar imagens ou vÃ­deos. Por favor, envie sua mensagem em texto ou voz.","additionalFields":{"appendAttribution":false,"parse_mode":"HTML"}},"id":"59f6ce0e-0f5c-4783-ac9e-1df08a917680","name":"Send Fallback Message","type":"n8n-nodes-base.telegram","position":[16,288],"webhookId":"54a95e4f-38b0-4992-a5c1-81791dba21ab","typeVersion":1.2,"credentials":{"telegramApi":{"id":"zrkbeFNT5vHFvHXN","name":"finnase"}}},{"parameters":{"chatId":"={{ $('Telegram Bot Trigger').item.json.message.from.id }}","text":"={{ $json.cleanedOutput }}","additionalFields":{"appendAttribution":false,"parse_mode":"HTML"}},"id":"f3d8e75a-b09e-4f04-a93e-0ba9c1b69104","name":"Send Response","type":"n8n-nodes-base.telegram","position":[1376,-32],"webhookId":"54a95e4f-38b0-4992-a5c1-81791dba21ab","typeVersion":1.2,"credentials":{"telegramApi":{"id":"zrkbeFNT5vHFvHXN","name":"finnase"}}},{"parameters":{"content":"## Setup Telegram Bot Trigger\n\n1. Create a new bot using @BotFather on Telegram.\n\n2. Copy the bot token provided by BotFather.\n\n3. Paste the token into the Telegram Trigger node credentials.\n\n4. Make sure the bot is active and can receive messages.\n\n5. This node starts the workflow whenever a new message is received.\n","height":576,"width":320,"color":7},"id":"67e841c0-eca7-46ab-9f3b-990aea2d80a9","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[-528,-288],"typeVersion":1},{"parameters":{"updates":["message"],"additionalFields":{}},"id":"a576da87-3aa1-4178-8045-76f6f536baca","name":"Telegram Bot Trigger","type":"n8n-nodes-base.telegramTrigger","position":[-432,80],"webhookId":"3fb3235c-eaa7-421e-a3d2-90cc42e88f1e","typeVersion":1.2,"credentials":{"telegramApi":{"id":"zrkbeFNT5vHFvHXN","name":"finnase"}}},{"parameters":{"content":"## Google Sheets Configuration\n\n1. Create a Google Sheet with the following columns: \n   id | type | value | category | payment_method | description | date\n\n2. Leave rows empty for automatic insertion.\n\n3. Set up a Google Service Account and share the sheet with it.\n\n4. Configure the Google Sheets node with proper credentials and Sheet name.\n","height":80,"width":528,"color":7},"id":"5817755c-ca1f-4fa6-a820-98801a3ea464","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[1088,-160],"typeVersion":1},{"parameters":{"content":"## Gemini To Transcription\n\nInsert your Google Gemini Credentials","height":352,"width":224,"color":7},"id":"5554deff-eac0-491d-be21-fa691162f15c","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[176,-112],"typeVersion":1},{"parameters":{"content":"## Gemini LLM\n\nInsert your Google Gemini Credentials","height":224,"width":224,"color":7},"id":"fd761929-784e-498e-b8af-dc43daeedc93","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","position":[320,336],"typeVersion":1},{"parameters":{"content":"","width":640,"color":7},"id":"64831a49-f661-4e23-901c-ea0980db2e0d","name":"Sticky Note5","type":"n8n-nodes-base.stickyNote","position":[768,224],"typeVersion":1},{"parameters":{"content":"## ğŸ“Œ Follow me:\n### [LinkedIn](https://www.linkedin.com/in/vikthyr)","height":80,"width":192},"id":"6174b6ef-1477-4c3c-b78b-a40ec6daca3e","name":"Sticky Note6","type":"n8n-nodes-base.stickyNote","position":[-176,-32],"typeVersion":1},{"parameters":{"description":"call this tool to get the all data ","workflowId":{"__rl":true,"value":"HKuxyPa86pR4gJfe","mode":"list","cachedResultUrl":"/workflow/HKuxyPa86pR4gJfe","cachedResultName":"data"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[1152,272],"id":"b0d7206f-b9e7-4442-982f-de3ed097a3dc","name":"Call 'data'"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[832,272],"id":"b8d93c92-ccb2-49cf-bf5f-622e0be80511","name":"Calculator"},{"parameters":{"jsCode":"// Remove thinking tags and their content\nlet text = $input.item.json.output;\n\n// Remove <thinking>...</thinking> blocks\ntext = text.replace(/<thinking>[\\s\\S]*?<\\/thinking>/gi, '');\n\n// Trim any extra whitespace\ntext = text.trim();\n\nreturn { json: { cleanedOutput: text } };\n```\n\nThen in the \"Send Response\" node, change the Text field to:\n```\n{{ $json.cleanedOutput }}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1008,-48],"id":"05259d8a-1ac1-43c4-a1a3-e881a7f10259","name":"Code in JavaScript"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[704,288],"id":"1ef0422f-14e1-4313-85a5-c6af8ced2969","name":"OpenRouter Chat Model","credentials":{"openRouterApi":{"id":"ypsTIXKbBaqMjw1s","name":"OpenRouter account"}}}],"connections":{"Switch":{"main":[[{"node":"Financial Agent","type":"main","index":0}],[{"node":"Get a file","type":"main","index":0}],[{"node":"Send Fallback Message","type":"main","index":0}]]},"Get a file":{"main":[[{"node":"Transcribe a recording","type":"main","index":0}]]},"Transcribe a recording":{"main":[[{"node":"Financial Agent","type":"main","index":0}]]},"update_register":{"ai_tool":[[{"node":"Financial Agent","type":"ai_tool","index":0}]]},"get_all_registers":{"ai_tool":[[{"node":"Financial Agent","type":"ai_tool","index":0}]]},"create_new_register":{"ai_tool":[[{"node":"Financial Agent","type":"ai_tool","index":0}]]},"delete_register":{"ai_tool":[[{"node":"Financial Agent","type":"ai_tool","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"Financial Agent","type":"ai_memory","index":0}]]},"Financial Agent":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}]]},"Telegram Bot Trigger":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Call 'data'":{"ai_tool":[[{"node":"Financial Agent","type":"ai_tool","index":0}]]},"Calculator":{"ai_tool":[[{"node":"Financial Agent","type":"ai_tool","index":0}]]},"Code in JavaScript":{"main":[[{"node":"Send Response","type":"main","index":0}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"Financial Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"6b5cdc1e-3e63-42c0-8f5b-3c9e950ffbba","activeVersionId":"07e559a6-9867-4bd6-b975-afe1f3e52fd8","triggerCount":1,"shared":[{"updatedAt":"2026-01-14T02:25:28.541Z","createdAt":"2026-01-14T02:25:28.541Z","role":"workflow:owner","workflowId":"DIXX3F1RLn1_F5u-tB4N_","projectId":"f7lZ9I1x9DksCYtb"}],"activeVersion":{"updatedAt":"2026-01-14T02:30:22.000Z","createdAt":"2026-01-14T02:29:19.081Z","versionId":"07e559a6-9867-4bd6-b975-afe1f3e52fd8","workflowId":"DIXX3F1RLn1_F5u-tB4N_","nodes":[{"parameters":{"rules":{"values":[{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"2d5b2f97-1f8f-48d9-8c81-515e77996efe","operator":{"type":"string","operation":"exists","singleValue":true},"leftValue":"={{ $json.message.text }}","rightValue":""}]},"renameOutput":true,"outputKey":"Text"},{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"2d880d6b-56c3-4daa-b4ec-3a72d397b41b","operator":{"type":"object","operation":"exists","singleValue":true},"leftValue":"={{ $json.message.voice }}","rightValue":""}]},"renameOutput":true,"outputKey":"Voice"}]},"options":{"fallbackOutput":"extra"}},"id":"98697402-9510-402e-9b52-ebf1aa2d95c3","name":"Switch","type":"n8n-nodes-base.switch","position":[-208,64],"typeVersion":3.2},{"parameters":{"resource":"file","fileId":"={{ $('Telegram Bot Trigger').item.json.message.voice.file_id }}","additionalFields":{}},"id":"87964aba-28be-4f06-b9e0-12313a2abeae","name":"Get a file","type":"n8n-nodes-base.telegram","position":[16,80],"webhookId":"e3f61732-60a5-4116-8350-18f853286b1d","typeVersion":1.2,"credentials":{"telegramApi":{"id":"zrkbeFNT5vHFvHXN","name":"finnase"}}},{"parameters":{"resource":"audio","modelId":{"__rl":true,"mode":"list","value":"models/gemini-2.5-flash","cachedResultName":"models/gemini-2.5-flash"},"inputType":"binary","options":{}},"id":"9046ce26-bc4b-438c-8168-df48f0607088","name":"Transcribe a recording","type":"@n8n/n8n-nodes-langchain.googleGemini","position":[240,80],"typeVersion":1,"credentials":{"googlePalmApi":{"id":"qRaMgNaHuCCLU0Vt","name":"Google Gemini(PaLM) Api account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Update row in sheet in Google Sheets. Use this tool to update registers in Google Sheets.","operation":"update","documentId":{"__rl":true,"value":"1KEt6xF4TB-8Cacz92jivkQt4-hmQCtXyZAFWcvIE4g0","mode":"list","cachedResultName":"daily finnase","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1KEt6xF4TB-8Cacz92jivkQt4-hmQCtXyZAFWcvIE4g0/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1KEt6xF4TB-8Cacz92jivkQt4-hmQCtXyZAFWcvIE4g0/edit#gid=0"},"columns":{"mappingMode":"autoMapInputData","value":{"id":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('id', ``, 'string') }}","row_number":0},"matchingColumns":["date"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"type","displayName":"type","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"value","displayName":"value","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"category","displayName":"category","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"payment_method","displayName":"payment_method","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"descrition","displayName":"descrition","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"date","displayName":"date","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"row_number","displayName":"row_number","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"readOnly":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"id":"4176f321-9af7-4f07-b466-e655a652103a","name":"update_register","type":"n8n-nodes-base.googleSheetsTool","position":[944,272],"typeVersion":4.6,"credentials":{"googleSheetsOAuth2Api":{"id":"OK8uabSCc25Un5lJ","name":"Google Sheets account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Get all row in sheet of Google Sheets. You can use this tool to get all informations.","documentId":{"__rl":true,"value":"1KEt6xF4TB-8Cacz92jivkQt4-hmQCtXyZAFWcvIE4g0","mode":"list","cachedResultName":"daily finnase","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1KEt6xF4TB-8Cacz92jivkQt4-hmQCtXyZAFWcvIE4g0/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1KEt6xF4TB-8Cacz92jivkQt4-hmQCtXyZAFWcvIE4g0/edit#gid=0"},"options":{}},"id":"f590e0fb-d7d4-482e-87ea-5bcb088151fe","name":"get_all_registers","type":"n8n-nodes-base.googleSheetsTool","position":[1040,272],"typeVersion":4.6,"credentials":{"googleSheetsOAuth2Api":{"id":"OK8uabSCc25Un5lJ","name":"Google Sheets account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"=Append row in sheet in Google Sheets. You can use this tool to append new registers in the Google Sheets.","operation":"append","documentId":{"__rl":true,"value":"1KEt6xF4TB-8Cacz92jivkQt4-hmQCtXyZAFWcvIE4g0","mode":"list","cachedResultName":"daily finnase","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1KEt6xF4TB-8Cacz92jivkQt4-hmQCtXyZAFWcvIE4g0/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1KEt6xF4TB-8Cacz92jivkQt4-hmQCtXyZAFWcvIE4g0/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"id":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('id', ``, 'string') }}","type":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('type', ``, 'string') }}","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('value', ``, 'string') }}","category":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('category', ``, 'string') }}","payment_method":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('payment_method', ``, 'string') }}","descrition":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('descrition', ``, 'string') }}","date":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('date', ``, 'string') }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"type","displayName":"type","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"value","displayName":"value","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"category","displayName":"category","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"payment_method","displayName":"payment_method","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"descrition","displayName":"descrition","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"date","displayName":"date","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"id":"9208b29c-493b-48a6-a3e4-c1f7916b54cc","name":"create_new_register","type":"n8n-nodes-base.googleSheetsTool","position":[1264,272],"typeVersion":4.6,"credentials":{"googleSheetsOAuth2Api":{"id":"OK8uabSCc25Un5lJ","name":"Google Sheets account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Delete rows from sheet in Google Sheets. You can use this tool to delete registers in Google Sheets.","operation":"delete","documentId":{"__rl":true,"value":"1KEt6xF4TB-8Cacz92jivkQt4-hmQCtXyZAFWcvIE4g0","mode":"list","cachedResultName":"daily finnase","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1KEt6xF4TB-8Cacz92jivkQt4-hmQCtXyZAFWcvIE4g0/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1KEt6xF4TB-8Cacz92jivkQt4-hmQCtXyZAFWcvIE4g0/edit#gid=0"},"startIndex":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start_Row_Number', ``, 'number') }}","numberToDelete":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Number_of_Rows_to_Delete', ``, 'number') }}"},"id":"cbf0ea53-9abc-4ab8-893f-fa3de6df9f85","name":"delete_register","type":"n8n-nodes-base.googleSheetsTool","position":[1360,256],"typeVersion":4.6,"credentials":{"googleSheetsOAuth2Api":{"id":"OK8uabSCc25Un5lJ","name":"Google Sheets account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Telegram Bot Trigger').item.json.message.from.id }}"},"id":"b7e62d7d-43a0-4da3-8346-0a38ed87f239","name":"Simple Memory","type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","position":[592,240],"typeVersion":1.3},{"parameters":{"promptType":"define","text":"={{ $json.content?.parts[0].text || $json.message.text }}","options":{"systemMessage":"=You are a financial assistant specialized in managing personal expenses and income via Telegram.\n\n## ğŸ¯ MAIN OBJECTIVE\n\nInterpret user messages on Telegram and manage financial records in a Google Sheets spreadsheet, providing accurate financial analyses and insights, **ALWAYS formatted exclusively in Telegram-valid HTML**.\n\n## ğŸ“‹ SPREADSHEET STRUCTURE\n\n**Available columns:**\n\n* **`id`**: Unique sequential identifier (auto-incremented)\n* **`tipo`**: \"income\" or \"expense\"\n* **`valor`**: Monetary value (format: 1234.56)\n* **`categoria`**: Classification of the expense/income\n* **`metodo_pagamento`**: Payment method used\n* **`descricao`**: Details about the transaction\n* **`data`**: Transaction date (format: yyyy-MM-dd)\n\n---\n\n## ğŸš¨ CRITICAL OPERATION RULES\n\n### 1. ğŸ“Š DATA QUERY\n\n* âœ… **ALWAYS** use `get_all_registers` BEFORE answering any question\n* âŒ **NEVER** rely on conversation memory for financial data\n* âœ… **ALWAYS** base responses on the data returned by the tool\n* âš ï¸ If no data is available, request more information from the user\n\n### 2. ğŸ“ TRANSACTION RECORDING\n\n**Mandatory flow:**\n\n1. ğŸ” First: `get_all_registers` to check the last ID\n2. â• Calculate: `new_id = last_id + 1`\n3. ğŸ’¾ Create: `create_new_register` with all fields filled\n4. âœ… Confirm: success message formatted in HTML\n\n### 3. ğŸ§  MESSAGE INTERPRETATION\n\n**Automatically extract:**\n\n* **Type:** `spent, paid, bought` = expense | `received, earned, entered` = income\n* **Value:** Numbers with currency symbols, e.g., R\\$, or numeric values\n* **Category:** Context of the transaction (e.g., \"lunch\" â†’ Food)\n* **Method:** `card, pix, cash, debit, credit`\n* **Date:** If not specified, use current date\n* **Description:** Details provided by the user\n\n### 4. ğŸ“‚ SUGGESTED CATEGORIES\n\n**ğŸ”´ Expenses:** Food, Transportation, Housing, Health, Education, Leisure, Shopping, Services, Others\n\n**ğŸŸ¢ Income:** Salary, Freelance, Investments, Sales, Gift, Others\n\n---\n\n## âš ï¸ HTML FORMATTING MANDATORY - TELEGRAM\n\n> **ğŸš¨ ABSOLUTE RULE:** ALL responses MUST be written EXCLUSIVELY in Telegram-valid HTML!\n\n### ğŸ“ HTML TAGS SUPPORTED BY TELEGRAM:\n\n* `<b>text</b>` or `<strong>text</strong>` â†’ bold text\n* `<i>text</i>` or `<em>text</em>` â†’ italic text\n* `<u>text</u>` or `<ins>text</ins>` â†’ underlined text\n* `<s>text</s>` or `<strike>text</strike>` or `<del>text</del>` â†’ strikethrough\n* `<code>text</code>` â†’ inline code with monospace font\n* `<pre>code</pre>` â†’ preformatted code block\n* `<a href=\"url\">link</a>` â†’ clickable link\n* `<blockquote>quote</blockquote>` â†’ blockquote\n\n### ğŸš¨ CRITICAL FORMATTING INSTRUCTIONS:\n\n1. **NEVER** use any other formatting syntax\n2. **ALWAYS** write responses in pure HTML\n3. **ALWAYS** use single line breaks to separate sections\n4. **ALWAYS** use the HTML tags listed above\n5. **ALWAYS** set `parse_mode: 'HTML'` in messages\n6. **LIMIT** emojis to a maximum of 3 per message\n7. **ESCAPE** special HTML characters: `<` â†’ `&lt;`, `>` â†’ `&gt;`, `&` â†’ `&amp;`\n\n---\n\n## ğŸ“Š TELEGRAM HTML RESPONSE TEMPLATES\n\n### ğŸ“ TEMPLATE: New Record\n\n```\n<b>âœ… Transaction Successfully Recorded!</b>\n\n<b>ğŸ“‹ Record Details:</b>\n<b>ğŸ†” ID:</b> <code>{id}</code>\n<b>ğŸ“Š Type:</b> <code>{tipo}</code>\n<b>ğŸ’µ Value:</b> <code>R$ {valor}</code>\n<b>ğŸ“‚ Category:</b> <code>{categoria}</code>\n<b>ğŸ’³ Method:</b> <code>{metodo_pagamento}</code>\n<b>ğŸ“… Date:</b> <code>{data}</code>\n<b>ğŸ“ Description:</b> {descricao}\n\n<i>ğŸ’¡ Type</i> <code>balance</code> <i>to see financial summary</i>\n<i>ğŸ’¡ Type</i> <code>expenses today</code> <i>for today's expenses</i>\n```\n\n### ğŸ’° TEMPLATE: Balance Query\n\n```\n<b>ğŸ’° FINANCIAL SUMMARY</b>\n\n<b>ğŸ“Š Current Status:</b>\n<b>ğŸ“ˆ Total Income:</b> <code>R$ {total_receitas}</code>\n<b>ğŸ“‰ Total Expenses:</b> <code>R$ {total_despesas}</code>\n<b>ğŸ’ Current Balance:</b> <code>R$ {saldo}</code>\n\n<b>ğŸ“… Analyzed Period:</b>\n<b>From:</b> <code>{data_inicial}</code> <b>to:</b> <code>{data_final}</code>\n\n<b>ğŸ“Š Status:</b> {saldo > 0 ? \"ğŸŸ¢ Positive Balance!\" : \"ğŸ”´ Warning: Negative Balance\"}\n```\n\n### ğŸ“Š TEMPLATE: Category Spending\n\n```\n<b>ğŸ“Š CATEGORY ANALYSIS</b>\n\n<b>ğŸ“… Period:</b> {periodo}\n\n<b>ğŸ” Food:</b> <code>R$ {valor}</code> <i>({percentual}%)</i>\n<b>ğŸš— Transportation:</b> <code>R$ {valor}</code> <i>({percentual}%)</i>\n<b>ğŸ  Housing:</b> <code>R$ {valor}</code> <i>({percentual}%)</i>\n<b>ğŸ® Leisure:</b> <code>R$ {valor}</code> <i>({percentual}%)</i>\n<b>ğŸ’¸ TOTAL:</b> <code>R$ {total}</code>\n\n<b>ğŸ“ˆ Insights:</b>\n<b>ğŸ” Highest expense:</b> {categoria} <i>({percentual}%)</i>\n<b>ğŸ“‰ Lowest expense:</b> {categoria} <i>({percentual}%)</i>\n<b>ğŸ’¡ Recommendation:</b> <i>{dica_personalizada}</i>\n```\n\n### ğŸ“‹ TEMPLATE: Transaction History\n\n```\n<b>ğŸ“‹ FINANCIAL HISTORY</b>\n\n<b>ğŸ” Applied Filters:</b>\n<b>ğŸ“… Period:</b> <code>{data_inicial}</code> to <code>{data_final}</code>\n<b>ğŸ“Š Type:</b> <code>{tipo}</code>\n<b>ğŸ“‚ Category:</b> <code>{categoria}</code>\n\n<b>ğŸ“Š Transactions Found:</b>\n\n<b>ID {id}:</b> <code>{data}</code> | {tipo_icone} | <i>{descricao}</i> | {categoria} | <code>R$ {valor}</code>\n\n<b>ğŸ“Š Summary:</b>\n<b>ğŸ“‹ Total Records:</b> <code>{quantidade}</code>\n<b>ğŸ’µ Total Expenses:</b> <code>R$ {total_despesas}</code>\n<b>ğŸ’° Total Income:</b> <code>R$ {total_receitas}</code>\n```\n\n### ğŸ“Š TEMPLATE: Monthly Report\n\n```\n<b>ğŸ“Š MONTHLY REPORT - {mes}/{ano}</b>\n\n<b>ğŸ’° Executive Dashboard</b>\n\n<b>ğŸ¯ Key Indicators:</b>\n<b>ğŸ’ Month Balance:</b> <code>R$ {saldo}</code> <i>({variacao}%)</i>\n<b>ğŸ“ˆ Income:</b> <code>R$ {receitas}</code>\n<b>ğŸ“‰ Expenses:</b> <code>R$ {despesas}</code>\n<b>ğŸ’ª Savings Rate:</b> <code>{taxa}%</code>\n\n<b>ğŸ“ˆ Period Income:</b>\n<b>ğŸ’° {fonte}:</b> <code>R$ {valor}</code> | <code>{data}</code>\n<b>TOTAL INCOME:</b> <code>R$ {total_receitas}</code>\n\n<b>ğŸ“‰ Top 5 Expense Categories:</b>\n<b>1. ğŸ  Housing:</b> <code>R$ {valor}</code> <i>({percentual}%)</i>\n<b>2. ğŸ” Food:</b> <code>R$ {valor}</code> <i>({percentual}%)</i>\n<b>3. ğŸš— Transportation:</b> <code>R$ {valor}</code> <i>({percentual}%)</i>\n<b>4. ğŸ® Leisure:</b> <code>R$ {valor}</code> <i>({percentual}%)</i>\n<b>5. ğŸ“š Education:</b> <code>R$ {valor}</code> <i>({percentual}%)</i>\n\n<b>ğŸ’¡ Insights and Recommendations:</b>\n<b>âš ï¸ Alert:</b> <i>Spending on {categoria} increased by {percentual}%</i>\n<b>âœ… Congratulations:</b> <i>You saved R$ {valor} this month</i>\n<b>ğŸ¯ Goal:</b> <i>Suggested R$ {valor} for next month</i>\n```\n\n### âš ï¸ TEMPLATE: Error Messages\n\n```\n<b>âš ï¸ Oops! Something went wrong</b>\n\n<b>ğŸš¨ Problem Details:</b>\n<b>Reason:</b> <i>{explicacao}</i>\n\n<b>ğŸ”§ How to fix:</b>\n<i>{solucao}</i>\n\n<b>ğŸ’¡ Correct Example:</b>\n<code>{exemplo}</code>\n\n<i>ğŸ’¬ Need help? Type</i> <code>help</code> <i>to see all commands</i>\n```\n\n### ğŸ”„ TEMPLATE: Confirmations\n\n```\n<b>ğŸ”„ Confirmation Required</b>\n\n<b>âš ï¸ You are about to {acao} this record:</b>\n\n<b>ğŸ†” ID:</b> <code>{id}</code>\n<b>ğŸ“Š Type:</b> <code>{tipo}</code>\n<b>ğŸ’µ Value:</b> <code>R$ {valor}</code>\n```\n\n\n<b>ğŸ“ Description:</b> <i>{descricao}</i> <b>ğŸ“… Date:</b> <code>{data}</code>\n\n<b>ğŸš¨ This action cannot be undone!</b>\n\n<b>ğŸ“± To confirm:</b> Type <code>confirm</code> <b>âŒ To cancel:</b> Type <code>cancel</code>\n\n```\n\n---\n\n## âš¡ MANDATORY WORKFLOW\n\n### 1. ğŸ“± **Receive Message**\n- Analyze user intent\n- Identify request type\n\n### 2. ğŸ” **If Query**\n```\n\nget\\_all\\_registers â†’ process data â†’ respond in HTML\n\n```\n\n### 3. â• **If Record**\n```\n\nget\\_all\\_registers â†’ calculate ID â†’ create\\_new\\_register â†’ confirm in HTML\n\n```\n\n### 4. âœï¸ **If Edit**\n```\n\nget\\_all\\_registers â†’ show current â†’ update\\_register â†’ confirm in HTML\n\n```\n\n### 5. ğŸ—‘ï¸ **If Delete**\n```\n\nget\\_all\\_registers â†’ confirm â†’ delete\\_register â†’ notify in HTML\n\n```\n\n---\n\n## ğŸ”§ AVAILABLE TOOLS\n\n- **`get_all_registers`**: Query records (always use first)\n- **`create_new_register`**: Add record (after get_all_registers)\n- **`update_register`**: Edit record (with valid ID)\n- **`delete_register`**: Delete record (with prior confirmation)\n- **`Calculator`**: Complex calculations (if needed)\n\n---\n\n## ğŸ“ ABSOLUTE HTML RULES\n\n### âœ… ALWAYS Use:\n1. **`<b>text</b>`** for bold and important highlights\n2. **`<i>text</i>`** for italics and secondary notes\n3. **`<code>text</code>`** for IDs, monetary values, dates, and commands\n4. **`<u>text</u>`** for important underlines (when needed)\n5. **`<s>text</s>`** for strikethrough (when appropriate)\n6. **Single line breaks** to separate sections\n7. **Limited emojis** (max 3 per response)\n\n### ğŸš¨ NEVER Use:\n- Any syntax other than HTML\n- Special formatting symbols\n- Any visual formatting not supported by HTML\n- Unsupported HTML tags for Telegram\n- Excessive emojis (more than 3 per message)\n\n---\n\n## ğŸ’¡ AVAILABLE COMMANDS (HTML)\n\n```\n\n<b>ğŸ’¡ Quick Commands:</b> <code>balance</code> - <i>View full financial summary</i> <code>expenses today</code> - <i>Current day expenses</i> <code>income month</code> - <i>Current month income</i> <code>report</code> - <i>Full financial analysis</i> <code>edit ID X</code> - <i>Modify a specific record</i> <code>delete ID X</code> - <i>Remove a specific record</i>\n\n<i>ğŸ’¬ Type</i> <code>help</code> <i>to see all available commands</i>\n\n```\n\n---\n\n## ğŸ“Œ CRITICAL SETTINGS\n\n- **ğŸ“… Current date/time:** `{{ $now.format('yyyy-MM-dd HH:mm:ss') }}`\n- **ğŸ“ Response limit:** 4096 characters (Telegram limit)\n- **ğŸ¨ Formatting:** HTML mandatory (`parse_mode: 'HTML'`)\n- **ğŸ”’ Security:** Sensitive data - maximum accuracy\n- **ğŸ˜Š Tone:** Friendly and professional\n- **ğŸ“± Platform:** Telegram Bot API\n\n---\n\n## ğŸ¯ FINAL CRITICAL REMINDERS\n\n> **ğŸš¨ ABSOLUTE RULES - NEVER VIOLATE:**\n> 1. **ALWAYS** write ALL responses in Telegram-valid HTML\n> 2. **ALWAYS** use `get_all_registers` before any financial operation\n> 3. **ALWAYS** confirm actions with HTML templates\n> 4. **ALWAYS** set `parse_mode: 'HTML'` in all messages\n> 5. **ALWAYS** be accurate with financial data\n> 6. **NEVER** use any formatting other than pure HTML\n> 7. **NEVER** mix HTML with other formatting syntaxes\n> 8. Respond **ONLY** with Telegram-valid HTML, without including code, instructions, explanations, or any other format.\n\n**ğŸ¯ Main Objective:** Provide precise financial responses using only Telegram-valid HTML!\n\n**ğŸ“‹ Required Parse Mode:** `parse_mode: 'HTML'` in all messages sent by the bot!"}},"id":"67ef69c3-5781-4144-a236-30e7a7aa4a42","name":"Financial Agent","type":"@n8n/n8n-nodes-langchain.agent","position":[656,-48],"typeVersion":2},{"parameters":{"chatId":"={{ $('Telegram Bot Trigger').item.json.message.from.id }}","text":"=âš ï¸ Desculpe! NÃ£o consigo processar imagens ou vÃ­deos. Por favor, envie sua mensagem em texto ou voz.","additionalFields":{"appendAttribution":false,"parse_mode":"HTML"}},"id":"59f6ce0e-0f5c-4783-ac9e-1df08a917680","name":"Send Fallback Message","type":"n8n-nodes-base.telegram","position":[16,288],"webhookId":"54a95e4f-38b0-4992-a5c1-81791dba21ab","typeVersion":1.2,"credentials":{"telegramApi":{"id":"zrkbeFNT5vHFvHXN","name":"finnase"}}},{"parameters":{"chatId":"={{ $('Telegram Bot Trigger').item.json.message.from.id }}","text":"={{ $json.cleanedOutput }}","additionalFields":{"appendAttribution":false,"parse_mode":"HTML"}},"id":"f3d8e75a-b09e-4f04-a93e-0ba9c1b69104","name":"Send Response","type":"n8n-nodes-base.telegram","position":[1600,-64],"webhookId":"54a95e4f-38b0-4992-a5c1-81791dba21ab","typeVersion":1.2,"credentials":{"telegramApi":{"id":"zrkbeFNT5vHFvHXN","name":"finnase"}}},{"parameters":{"content":"## Setup Telegram Bot Trigger\n\n1. Create a new bot using @BotFather on Telegram.\n\n2. Copy the bot token provided by BotFather.\n\n3. Paste the token into the Telegram Trigger node credentials.\n\n4. Make sure the bot is active and can receive messages.\n\n5. This node starts the workflow whenever a new message is received.\n","height":576,"width":320,"color":7},"id":"67e841c0-eca7-46ab-9f3b-990aea2d80a9","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[-528,-288],"typeVersion":1},{"parameters":{"updates":["message"],"additionalFields":{}},"id":"a576da87-3aa1-4178-8045-76f6f536baca","name":"Telegram Bot Trigger","type":"n8n-nodes-base.telegramTrigger","position":[-432,80],"webhookId":"3fb3235c-eaa7-421e-a3d2-90cc42e88f1e","typeVersion":1.2,"credentials":{"telegramApi":{"id":"zrkbeFNT5vHFvHXN","name":"finnase"}}},{"parameters":{"content":"## Google Sheets Configuration\n\n1. Create a Google Sheet with the following columns: \n   id | type | value | category | payment_method | description | date\n\n2. Leave rows empty for automatic insertion.\n\n3. Set up a Google Service Account and share the sheet with it.\n\n4. Configure the Google Sheets node with proper credentials and Sheet name.\n","height":80,"width":528,"color":7},"id":"5817755c-ca1f-4fa6-a820-98801a3ea464","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[1088,-160],"typeVersion":1},{"parameters":{"content":"## Gemini To Transcription\n\nInsert your Google Gemini Credentials","height":352,"width":224,"color":7},"id":"5554deff-eac0-491d-be21-fa691162f15c","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[176,-112],"typeVersion":1},{"parameters":{"content":"## Gemini LLM\n\nInsert your Google Gemini Credentials","height":224,"width":224,"color":7},"id":"fd761929-784e-498e-b8af-dc43daeedc93","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","position":[320,336],"typeVersion":1},{"parameters":{"content":"","width":640,"color":7},"id":"64831a49-f661-4e23-901c-ea0980db2e0d","name":"Sticky Note5","type":"n8n-nodes-base.stickyNote","position":[768,224],"typeVersion":1},{"parameters":{"content":"## ğŸ“Œ Follow me:\n### [LinkedIn](https://www.linkedin.com/in/vikthyr)","height":80,"width":192},"id":"6174b6ef-1477-4c3c-b78b-a40ec6daca3e","name":"Sticky Note6","type":"n8n-nodes-base.stickyNote","position":[-176,-32],"typeVersion":1},{"parameters":{"description":"call this tool to get the all data ","workflowId":{"__rl":true,"value":"HKuxyPa86pR4gJfe","mode":"list","cachedResultUrl":"/workflow/HKuxyPa86pR4gJfe","cachedResultName":"data"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[1152,272],"id":"b0d7206f-b9e7-4442-982f-de3ed097a3dc","name":"Call 'data'"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[832,272],"id":"b8d93c92-ccb2-49cf-bf5f-622e0be80511","name":"Calculator"},{"parameters":{"jsCode":"// Remove thinking tags and their content\nlet text = $input.item.json.output;\n\n// Remove <thinking>...</thinking> blocks\ntext = text.replace(/<thinking>[\\s\\S]*?<\\/thinking>/gi, '');\n\n// Trim any extra whitespace\ntext = text.trim();\n\nreturn { json: { cleanedOutput: text } };\n```\n\nThen in the \"Send Response\" node, change the Text field to:\n```\n{{ $json.cleanedOutput }}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1008,-48],"id":"05259d8a-1ac1-43c4-a1a3-e881a7f10259","name":"Code in JavaScript"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[704,288],"id":"1ef0422f-14e1-4313-85a5-c6af8ced2969","name":"OpenRouter Chat Model","credentials":{"openRouterApi":{"id":"ypsTIXKbBaqMjw1s","name":"OpenRouter account"}}}],"connections":{"Switch":{"main":[[{"node":"Financial Agent","type":"main","index":0}],[{"node":"Get a file","type":"main","index":0}],[{"node":"Send Fallback Message","type":"main","index":0}]]},"Get a file":{"main":[[{"node":"Transcribe a recording","type":"main","index":0}]]},"Transcribe a recording":{"main":[[{"node":"Financial Agent","type":"main","index":0}]]},"update_register":{"ai_tool":[[{"node":"Financial Agent","type":"ai_tool","index":0}]]},"get_all_registers":{"ai_tool":[[{"node":"Financial Agent","type":"ai_tool","index":0}]]},"create_new_register":{"ai_tool":[[{"node":"Financial Agent","type":"ai_tool","index":0}]]},"delete_register":{"ai_tool":[[{"node":"Financial Agent","type":"ai_tool","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"Financial Agent","type":"ai_memory","index":0}]]},"Financial Agent":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}]]},"Telegram Bot Trigger":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Call 'data'":{"ai_tool":[[{"node":"Financial Agent","type":"ai_tool","index":0}]]},"Calculator":{"ai_tool":[[{"node":"Financial Agent","type":"ai_tool","index":0}]]},"Code in JavaScript":{"main":[[{"node":"Send Response","type":"main","index":0}]]},"OpenRouter Chat Model":{"ai_languageModel":[[{"node":"Financial Agent","type":"ai_languageModel","index":0}]]}},"authors":"adam quriat12@gmail.com","name":"Version 07e559a6","description":"","autosaved":true},"tags":[]}